const data = {
  IQ_Range_Lookup_Table: {
    description: "IQ Range Lookup Table for 60 Questions (Time-Adjusted)",
    data: [
      {
        correct_answers: [0, 19],
        time_taken_minutes: 60,
        age_group: null,
        percentile: [0, 2],
        estimated_iq_range: [0, 70],
        label: "Below 70",
        description: "Intellectual Disability"
      },
      {
        correct_answers: [20],
        time_taken_minutes: 60,
        age_group: null,
        percentile: [2, 3],
        estimated_iq_range: [70, 71],
        label: "70",
        description: "Borderline"
      },
      {
        correct_answers: [21],
        time_taken_minutes: 60,
        age_group: null,
        percentile: [3, 4],
        estimated_iq_range: [72, 73],
        label: "72",
        description: "Borderline"
      },
      {
        correct_answers: [22],
        time_taken_minutes: 60,
        age_group: null,
        percentile: [4, 5],
        estimated_iq_range: [74, 75],
        label: "74",
        description: "Borderline"
      },
      {
        correct_answers: [23],
        time_taken_minutes: 60,
        age_group: null,
        percentile: [5, 6],
        estimated_iq_range: [76, 77],
        label: "76",
        description: "Borderline"
      },
      {
        correct_answers: [24],
        time_taken_minutes: 60,
        age_group: null,
        percentile: [6, 7],
        estimated_iq_range: [77, 78],
        label: "77.5",
        description: "Borderline"
      },
      {
        correct_answers: [25],
        time_taken_minutes: 60,
        age_group: null,
        percentile: [7, 9],
        estimated_iq_range: [80, 81],
        label: "80",
        description: "Low Average"
      },
      {
        correct_answers: [26],
        time_taken_minutes: 60,
        age_group: null,
        percentile: [9, 12],
        estimated_iq_range: [82, 83],
        label: "82.5",
        description: "Low Average"
      },
      {
        correct_answers: [27],
        time_taken_minutes: 60,
        age_group: null,
        percentile: [12, 16],
        estimated_iq_range: [85, 86],
        label: "85",
        description: "Low Average"
      },
      {
        correct_answers: [28],
        time_taken_minutes: 60,
        age_group: null,
        percentile: [16, 20],
        estimated_iq_range: [87, 88],
        label: "87.5",
        description: "Low Average"
      },
      {
        correct_answers: [29],
        time_taken_minutes: 60,
        age_group: null,
        percentile: [20, 25],
        estimated_iq_range: [90, 91],
        label: "90",
        description: "Average"
      },
      {
        correct_answers: [30],
        time_taken_minutes: 60,
        age_group: null,
        percentile: [25, 30],
        estimated_iq_range: [92, 93],
        label: "92.5",
        description: "Average"
      },
      {
        correct_answers: [31],
        time_taken_minutes: 60,
        age_group: null,
        percentile: [30, 35],
        estimated_iq_range: [95, 96],
        label: "95",
        description: "Average"
      },
      {
        correct_answers: [32],
        time_taken_minutes: 60,
        age_group: null,
        percentile: [35, 40],
        estimated_iq_range: [97, 98],
        label: "97.5",
        description: "Average"
      },
      {
        correct_answers: [33],
        time_taken_minutes: 60,
        age_group: null,
        percentile: [40, 50],
        estimated_iq_range: [100, 101],
        label: "100",
        description: "Average"
      },
      {
        correct_answers: [34],
        time_taken_minutes: 60,
        age_group: null,
        percentile: [50, 55],
        estimated_iq_range: [102, 103],
        label: "102.5",
        description: "Average"
      },
      {
        correct_answers: [35],
        time_taken_minutes: 60,
        age_group: null,
        percentile: [55, 60],
        estimated_iq_range: [105, 106],
        label: "105",
        description: "Above Average"
      },
      {
        correct_answers: [36],
        time_taken_minutes: 60,
        age_group: null,
        percentile: [60, 65],
        estimated_iq_range: [107, 108],
        label: "107.5",
        description: "Above Average"
      },
      {
        correct_answers: [37],
        time_taken_minutes: 60,
        age_group: null,
        percentile: [65, 70],
        estimated_iq_range: [110, 111],
        label: "110",
        description: "Above Average"
      },
      {
        correct_answers: [38],
        time_taken_minutes: 60,
        age_group: null,
        percentile: [70, 75],
        estimated_iq_range: [112, 113],
        label: "112.5",
        description: "Above Average"
      },
      {
        correct_answers: [39, 40],
        time_taken_minutes: 60,
        age_group: null,
        percentile: [75, 80],
        estimated_iq_range: [115, 116],
        label: "115",
        description: "High Average"
      },
      {
        correct_answers: [41],
        time_taken_minutes: 60,
        age_group: null,
        percentile: [80, 85],
        estimated_iq_range: [117, 118],
        label: "117.5",
        description: "High Average"
      },
      {
        correct_answers: [42],
        time_taken_minutes: 60,
        age_group: null,
        percentile: [85, 87],
        estimated_iq_range: [120, 121],
        label: "120",
        description: "Superior"
      },
      {
        correct_answers: [43],
        time_taken_minutes: 60,
        age_group: null,
        percentile: [87, 89],
        estimated_iq_range: [122, 123],
        label: "122.5",
        description: "Superior"
      },
      {
        correct_answers: [44],
        time_taken_minutes: 60,
        age_group: null,
        percentile: [89, 91],
        estimated_iq_range: [125, 126],
        label: "125",
        description: "Superior"
      },
      {
        correct_answers: [45],
        time_taken_minutes: 60,
        age_group: null,
        percentile: [91, 93],
        estimated_iq_range: [127, 128],
        label: "127.5",
        description: "Superior"
      },
      {
        correct_answers: [46],
        time_taken_minutes: 60,
        age_group: null,
        percentile: [93, 95],
        estimated_iq_range: [130, 131],
        label: "130",
        description: "Very Superior"
      },
      {
        correct_answers: [47],
        time_taken_minutes: 60,
        age_group: null,
        percentile: [95, 96],
        estimated_iq_range: [132, 133],
        label: "132.5",
        description: "Very Superior"
      },
      {
        correct_answers: [48],
        time_taken_minutes: 60,
        age_group: null,
        percentile: [96, 97],
        estimated_iq_range: [135, 136],
        label: "135",
        description: "Very Superior"
      },
      {
        correct_answers: [49],
        time_taken_minutes: 60,
        age_group: null,
        percentile: [97, 98],
        estimated_iq_range: [137, 138],
        label: "137.5",
        description: "Very Superior"
      },
      {
        correct_answers: [50],
        time_taken_minutes: 60,
        age_group: null,
        percentile: [98, 98.5],
        estimated_iq_range: [140, 141],
        label: "140",
        description: "Gifted"
      },
      {
        correct_answers: [51],
        time_taken_minutes: 60,
        age_group: null,
        percentile: [98.5, 99],
        estimated_iq_range: [142, 143],
        label: "142.5",
        description: "Gifted"
      },
      {
        correct_answers: [52],
        time_taken_minutes: 60,
        age_group: null,
        percentile: [99, 99.3],
        estimated_iq_range: [145, 146],
        label: "145",
        description: "Highly Gifted"
      },
      {
        correct_answers: [53],
        time_taken_minutes: 60,
        age_group: null,
        percentile: [99.3, 99.5],
        estimated_iq_range: [147, 148],
        label: "147.5",
        description: "Highly Gifted"
      },
      {
        correct_answers: [54],
        time_taken_minutes: 60,
        age_group: null,
        percentile: [99.5, 99.7],
        estimated_iq_range: [150, 151],
        label: "150",
        description: "Highly Gifted"
      },
      {
        correct_answers: [55],
        time_taken_minutes: 60,
        age_group: null,
        percentile: [99.7, 99.8],
        estimated_iq_range: [152, 153],
        label: "152.5",
        description: "Exceptionally Gifted"
      },
      {
        correct_answers: [56],
        time_taken_minutes: 60,
        age_group: null,
        percentile: [99.8, 99.85],
        estimated_iq_range: [155, 156],
        label: "155",
        description: "Exceptionally Gifted"
      },
      {
        correct_answers: [57],
        time_taken_minutes: 60,
        age_group: null,
        percentile: [99.85, 99.9],
        estimated_iq_range: [157, 158],
        label: "157.5",
        description: "Exceptionally Gifted"
      },
      {
        correct_answers: [58],
        time_taken_minutes: 60,
        age_group: null,
        percentile: [99.9, 99.95],
        estimated_iq_range: [160, 161],
        label: "160",
        description: "Profoundly Gifted"
      },
      {
        correct_answers: [59],
        time_taken_minutes: 60,
        age_group: null,
        percentile: [99.95, 99.97],
        estimated_iq_range: [162, 163],
        label: "162.5",
        description: "Profoundly Gifted"
      },
      {
        correct_answers: [60],
        time_taken_minutes: 60,
        age_group: null,
        percentile: [99.97, 100],
        estimated_iq_range: [165, 200],
        label: "165+",
        description: "Profoundly Gifted"
      }
    ],
  },
};

exports.calculateIQ = (correctAnswers, timeTaken) => {
  const iqTable = data.IQ_Range_Lookup_Table.data;
  
  for (let entry of iqTable) {
    if (
      matchRange(entry.correct_answers, correctAnswers) &&
      matchTime(entry.time_taken_minutes, timeTaken)
    ) {
      return entry;
    }
  }
  return { estimated_iq_range: "Unknown", percentile: "Unknown" };
};

const matchRange = (range, value) => {
  if (range.length === 1) {
    return value === range[0]; // Treat single-value array as a single number
  }
  return value >= range[0] && value <= range[1];
};

const matchTime = (ordTime, time) => {
  return time <= ordTime;
};
